---
description: CloudBase AI 开发规则
globs: ["**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx", "**/*.json", "**/*.md"]
---
# CloudBase AI 开发规则

## 技术栈约定
- 前端：优先使用 React + TypeScript + Vite 构建 Web 应用，使用微信小程序原生框架开发小程序。
- 后端：优先使用 CloudBase 云函数（Node.js 18+）实现业务逻辑。
- 数据库：使用 CloudBase 云数据库存储业务数据，集合名使用复数、小写下划线命名（如 `users`, `articles`）。
- 存储：使用 CloudBase 云存储存放图片、文件等静态资源，通过 `cloud://` 协议访问。

## 云开发使用规范
- 所有后端接口优先实现为云函数，不要在前端直接操作数据库。
- 访问数据库时，必须处理异常情况，禁止在代码中忽略错误。
- 云函数入口文件必须导出 `main` 异步函数，并正确处理 `event` 和 `context` 参数。
- 涉及用户登录、权限校验的功能，必须优先使用微信登录或手机号登录等 CloudBase 官方能力。

## 安全与权限
- 云数据库集合的权限应根据业务需求设置为“仅创建者可读写”、“所有用户可读，仅创建者可写”等，禁止默认开放全部读写权限。
- 涉及敏感操作（如删除、修改重要数据）的接口，必须在云函数中进行权限校验。
- 云函数环境变量中禁止存放任何密钥、密码等敏感信息，应使用 CloudBase 的环境变量或密钥管理功能。

## 错误处理与日志
- 云函数必须使用 `try/catch` 捕获异常，并通过 `console.error` 输出详细错误信息。
- 前端调用云函数时，必须处理失败情况，并向用户展示友好的错误提示。
- 调试时，优先通过 CloudBase 控制台的日志功能查看云函数运行日志。

## 代码风格与规范
- 代码缩进使用 2 个空格，语句末尾必须使用分号。
- 变量和函数命名采用小驼峰命名法（如 `getUserInfo`）。
- 常量命名采用全大写加下划线命名法（如 `MAX_RETRY_COUNT`）。
- 文件和目录命名使用小写字母加中划线（如 `user-service`）。

## AI 行为约束
- 在生成代码时，必须严格遵循上述技术栈约定和开发规范。
- 当需要创建新功能时，应优先使用 CloudBase 提供的云数据库、云函数、云存储等能力，避免引入不必要的第三方服务。
- 当需要实现用户认证、权限控制等功能时，应优先使用 CloudBase 的官方认证方案。
- 在修改现有代码时，必须保持代码风格的一致性，不得随意更改已有的代码结构和命名规范。
- 每次生成代码后，必须自动生成相应的注释和文档，说明代码的功能和实现思路。
